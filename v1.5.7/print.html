<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ZKsync Solidity Compiler Toolchain Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="css/version-box.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="01-installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="02-command-line-interface.html"><strong aria-hidden="true">2.</strong> Command Line Interface</a></li><li class="chapter-item expanded "><a href="03-standard-json.html"><strong aria-hidden="true">3.</strong> Standard JSON</a></li><li class="chapter-item expanded "><a href="04-combined-json.html"><strong aria-hidden="true">4.</strong> Combined JSON</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ZKsync Solidity Compiler Toolchain Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="installing-the-zksync-solidity-compiler-toolchain"><a class="header" href="#installing-the-zksync-solidity-compiler-toolchain">Installing the ZKsync Solidity Compiler Toolchain</a></h1>
<p>To compile contracts for ZKsync, you need the ZKsync Solidity compiler toolchain.
It consists of two components:</p>
<ol>
<li>The main component: <a href="https://github.com/matter-labs/era-compiler-solidity/releases"><em>zksolc</em></a>.</li>
<li>The additional component: <a href="https://docs.soliditylang.org/en/latest"><em>solc</em></a>, which produces Solidity artifacts used by <em>zksolc</em>.</li>
</ol>
<blockquote>
<p>We are using our <a href="https://github.com/matter-labs/era-solidity">fork</a> of the upstream <em>solc</em> compiler.
The fork is necessary to support several ZKsync-specific features and workarounds.</p>
</blockquote>
<h2 id="system-requirements"><a class="header" href="#system-requirements">System Requirements</a></h2>
<p>It is recommended to have at least 4 GB of RAM to compile large projects. The compilation process is parallelized by default, so the number of threads used is
equal to the number of CPU cores.</p>
<blockquote>
<p>Large projects can consume a lot of RAM during compilation on machines with a high number of cores.
If you encounter memory issues, consider reducing the number of threads using the <code>--threads</code> option.</p>
</blockquote>
<p>The table below outlines the supported platforms and architectures:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">CPU/OS</th><th style="text-align: center">MacOS</th><th style="text-align: center">Linux</th><th style="text-align: center">Windows</th></tr></thead><tbody>
<tr><td style="text-align: center">x86_64</td><td style="text-align: center">✅</td><td style="text-align: center">✅</td><td style="text-align: center">✅</td></tr>
<tr><td style="text-align: center">arm64</td><td style="text-align: center">✅</td><td style="text-align: center">✅</td><td style="text-align: center">❌</td></tr>
</tbody></table>
</div>
<blockquote>
<p>Please avoid using outdated distributions of operating systems, as they may lack the necessary dependencies or include outdated versions of them.
<em>zksolc</em> is only tested on recent versions of popular distributions, such as MacOS 11.0 and Windows 10.</p>
</blockquote>
<div class="warning">
<a href="https://musl.libc.org">musl</a>-based builds are deprecated, but they are still supported to preserve tooling compatibility.<br>
Starting from <b>zksolc</b> v1.5.3, we are shipping builds statically linked with <a href="https://www.gnu.org/software/libc/">the GNU C library</a>.
</div>
<h2 id="versioning"><a class="header" href="#versioning">Versioning</a></h2>
<p>The <em>zksolc</em> versioning scheme does not yet follow the <a href="https://semver.org">Semantic Versioning</a> specification. Instead, its major and minor versions match those of the EraVM protocol for which <em>zksolc</em> produces bytecode. The patch version is incremented with each release, regardless of whether breaking changes are introduced. Therefore, please consult the changelog before updating the compiler.</p>
<blockquote>
<p>We recommend always using the latest version of <em>zksolc</em> and <em>solc</em> to benefit from the latest features and bug fixes.</p>
</blockquote>
<h2 id="installing-zksolc"><a class="header" href="#installing-zksolc">Installing <em>zksolc</em></a></h2>
<p>You can install the ZKsync Solidity compiler toolchain using the following methods:</p>
<ol>
<li>Use Foundry, Hardhat, or other popular toolkits, so they will manage the compiler installation and their dependencies for you. See <a href="01-installation.html#ethereum-development-toolkits">Ethereum Development Toolkits</a>.</li>
<li>Download pre-built binaries of <a href="https://github.com/matter-labs/era-solidity/releases"><em>solc</em></a> and <a href="https://github.com/matter-labs/era-compiler-solidity/releases"><em>zksolc</em></a>. See <a href="01-installation.html#static-executables">Static Executables</a>.</li>
<li>Build <em>zksolc</em> from sources. See <a href="01-installation.html#building-from-source">Building from Source</a>.</li>
</ol>
<blockquote>
<p>For small projects, learning and research purposes, <em>zksolc</em> and <em>solc</em> executables without a toolkit are sufficient.</p>
</blockquote>
<h2 id="installing-solc"><a class="header" href="#installing-solc">Installing <em>solc</em></a></h2>
<p>Running <em>zksolc</em> requires the <a href="https://github.com/matter-labs/era-solidity/releases">fork of the Solidity compiler <em>solc</em></a>, which is called by <em>zksolc</em> as a child process. To point <em>zksolc</em> to the location of <em>solc</em>, use one of the following methods:</p>
<ol>
<li>
<p>Add the location of <em>solc</em> to the environment variable <code>PATH</code>.</p>
<p>For example, if you have downloaded <em>solc</em> to the directory <code>/home/username/opt</code>,
you can execute the following command, or append it to the configuration file of your shell:</p>
<pre><code class="language-shell">export PATH="/home/username/opt:${PATH}"
</code></pre>
</li>
<li>
<p>Alternatively, when you run <em>zksolc</em>, provide the full path to <em>solc</em> using the <code>--solc</code> option.</p>
<p>For example, if <code>solc</code> is located in your current working directory, you can point to it with this command:</p>
<pre><code class="language-shell">zksolc --solc './solc' --bin 'Greeter.sol'
</code></pre>
</li>
</ol>
<blockquote>
<p>The second option is more convenient if you are using different versions of <em>solc</em> for different projects.
<em>zksolc</em> only supports <em>solc</em> of version 0.4.12 and newer.</p>
</blockquote>
<h2 id="ethereum-development-toolkits"><a class="header" href="#ethereum-development-toolkits">Ethereum Development Toolkits</a></h2>
<p>For large codebases, it is more convenient to use the ZKsync compiler toolchain via toolkits like Foundry and Hardhat.
These tools manage the compiler executables and their dependencies, and provide additional features like incremental compilation and caching.</p>
<p>The ZKsync toolchain is supported by the following toolkits:</p>
<p><em>TODO: Add links to the tutorials</em></p>
<h2 id="static-executables"><a class="header" href="#static-executables">Static Executables</a></h2>
<p>We ship <em>zksolc</em> binaries on the <a href="https://github.com/matter-labs/era-compiler-solidity/releases">releases page of <code>matter-labs/era-compiler-solidity</code> repository</a>.
This repository maintains intuitive and stable naming for the executables and provides a changelog for each release. Tools using <em>zksolc</em> will download the binaries from this repository and cache them locally.</p>
<div class="warning">
The <a href="https://github.com/matter-labs/era-compiler-solidity">matter-labs/era-compiler-solidity</a> repository only contains builds for versions 1.4.0 and newer.<br>
You can download older versions from <a href="https://github.com/matter-labs/zksolc-bin/tree/main">the main branch</a> or <a href="https://github.com/matter-labs/zksolc-bin/releases">the releases page</a> of the deprecated repository for zksolc executables.<br>
If any of your projects are still using the old locations, please change their download URLs to <a href="https://github.com/matter-labs/era-compiler-solidity/releases">the new one</a>.
</div>
<blockquote>
<p>All binaries are statically linked and must work on all recent platforms without issues.
<em>zksolc</em> is fully written in Rust, aiming to minimize incompatibilities with the environment.</p>
</blockquote>
<h2 id="building-from-source"><a class="header" href="#building-from-source">Building from Source</a></h2>
<blockquote>
<p>Please consider using the pre-built executables before building from source.
Building from source is only necessary for development, research, and debugging purposes.
Deployment and production use cases should rely only on <a href="01-installation.html#static-executables">the officially released executables</a>.</p>
</blockquote>
<ol>
<li>
<p>Install the necessary system-wide dependencies.</p>
<ul>
<li>For Linux (Debian):</li>
</ul>
<pre><code class="language-shell">apt install cmake ninja-build curl git libssl-dev pkg-config clang lld
</code></pre>
<ul>
<li>For Linux (Arch):</li>
</ul>
<pre><code class="language-shell">pacman -Syu which cmake ninja curl git pkg-config clang lld
</code></pre>
<ul>
<li>
<p>For MacOS:</p>
<ol>
<li>
<p>Install the <em>Homebrew</em> package manager by following the instructions at <a href="https://brew.sh">brew.sh</a>.</p>
</li>
<li>
<p>Install the necessary system-wide dependencies:</p>
<pre><code class="language-shell">brew install cmake ninja coreutils
</code></pre>
</li>
<li>
<p>Install a recent build of the LLVM/<a href="https://clang.llvm.org">Clang</a> compiler using one of the following tools:</p>
<ul>
<li><a href="https://developer.apple.com/xcode/">Xcode</a></li>
<li><a href="https://developer.apple.com/library/archive/technotes/tn2339/_index.html">Apple’s Command Line Tools</a></li>
<li>Your preferred package manager.</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
<li>
<p>Install Rust.</p>
<p>The easiest way to do it is following the latest <a href="https://www.rust-lang.org/tools/install">official instructions</a>.</p>
</li>
</ol>
<blockquote>
<p>The Rust version used for building is pinned in the <a href="../rust-toolchain.toml">rust-toolchain.toml</a> file at the repository root.
<em>cargo</em> will automatically download the pinned version of <em>rustc</em> when you start building the project.</p>
</blockquote>
<ol start="3">
<li>
<p>Clone and checkout this repository.</p>
<pre><code class="language-shell">git clone https://github.com/matter-labs/era-compiler-solidity
</code></pre>
</li>
<li>
<p>Install the ZKsync LLVM framework builder. This tool clones the <a href="https://github.com/matter-labs/era-compiler-llvm">repository of ZKsync LLVM Framework</a> and runs a sequence of build commands tuned for the needs of ZKsync compiler toolchain.</p>
<pre><code class="language-shell">cargo install compiler-llvm-builder
</code></pre>
<p>To fine-tune your build of ZKsync LLVM framework, refer to the section <a href="01-installation.html#fine-tuning-zksync-llvm-build">Fine tuning ZKsync LLVM build</a></p>
</li>
</ol>
<blockquote>
<p>Always use the latest version of the builder to benefit from the latest features and bug fixes.
To check for new versions and update the builder, simply run <code>cargo install compiler-llvm-builder</code> again, even if you have already installed the builder.
The builder is not the ZKsync LLVM framework itself, but a tool to build it.
By default, it is installed in <code>~/.cargo/bin/</code>, which is usually added to your <code>PATH</code> during the Rust installation process.</p>
</blockquote>
<ol start="5">
<li>
<p>Clone and build the ZKsync LLVM framework using the <code>zksync-llvm</code> tool.</p>
<pre><code class="language-shell"># Navigate to the root of your local copy of this repository.
cd era-compiler-solidity
# Clone the ZKsync LLVM framework. The branch is specified in the file `LLVM.lock`.
zksync-llvm clone
# Build the ZKsync LLVM framework.
zksync-llvm build
</code></pre>
<p>For more information and available build options, run <code>zksync-llvm build --help</code>.</p>
<p>You can also clone and build LLVM framework outside of the repository root.
In this case, do the following:</p>
<ol>
<li>
<p>Provide an <code>LLVM.lock</code> file in the directory where you run <code>zksync-llvm</code>.
See the <a href="../LLVM.lock">default LLVM.lock for an example</a>.</p>
</li>
<li>
<p>Ensure that <code>LLVM.lock</code> selects the correct branch of the <a href="https://github.com/matter-labs/era-compiler-llvm">ZKsync LLVM Framework repository</a>.</p>
</li>
<li>
<p>Before proceeding to the next step, set the environment variable <code>LLVM_SYS_170_PREFIX</code> to the path of the directory with the LLVM build artifacts.
Typically, it ends with <code>target-llvm/build-final</code>, which is the default LLVM target directory of the LLVM builder. For example:</p>
<pre><code class="language-shell">export LLVM_SYS_170_PREFIX=~/repositories/era-compiler-solidity/target-llvm/build-final 
</code></pre>
</li>
</ol>
</li>
<li>
<p>Build the <em>zksolc</em> executable.</p>
<pre><code class="language-shell">cargo build --release
</code></pre>
<p>The <em>zksolc</em> executable will appear at <code>./target/release/zksolc</code>, where you can run it directly or move it to another location.</p>
<p>If <em>cargo</em> cannot find the LLVM build artifacts, return to the previous step and ensure that the <code>LLVM_SYS_170_PREFIX</code> environment variable is set to the absolute path of the directory <code>target-llvm/build-final</code>.</p>
</li>
</ol>
<h2 id="tuning-the-zksync-llvm-build"><a class="header" href="#tuning-the-zksync-llvm-build">Tuning the ZKsync LLVM build</a></h2>
<ul>
<li>
<p>For more information and available build options, run <code>zksync-llvm build --help</code>.</p>
</li>
<li>
<p>Use the <code>--use-ccache</code> option to speed up the build process if you have <a href="https://ccache.dev">ccache</a> installed.</p>
</li>
<li>
<p>To build ZKsync LLVM framework using specific C and C++ compilers, pass additional arguments to <a href="https://cmake.org/">CMake</a> using the <code>--extra-args</code> option:</p>
<pre><code class="language-shell"># Pay special attention to character escaping.

zksync-llvm build \
  --use-ccache \
  --extra-args \
    '\-DCMAKE_C_COMPILER=/opt/homebrew/Cellar/llvm@18/18.1.8/bin/clang' \
    '\-DCMAKE_BUILD_TYPE=Release' \
    '\-DCMAKE_CXX_COMPILER=/opt/homebrew/Cellar/llvm@18/18.1.8/bin/clang++' 
</code></pre>
</li>
</ul>
<h3 id="building-llvm-manually"><a class="header" href="#building-llvm-manually">Building LLVM manually</a></h3>
<ul>
<li>
<p>If you prefer building <a href="https://github.com/matter-labs/era-compiler-llvm">your ZKsync LLVM</a> manually, include the following flags in your CMake command:</p>
<pre><code class="language-shell"># We recommended using the latest version of CMake.

-DLLVM_TARGETS_TO_BUILD='EraVM;EVM'
-DLLVM_ENABLE_PROJECTS='lld'
-DBUILD_SHARED_LIBS='Off'
</code></pre>
</li>
</ul>
<blockquote>
<p>For most users, the <a href="01-installation.html#building-from-source">ZKsync LLVM builder</a> is the recommended way to build the ZKsync LLVM framework.
This section exists for the ZKsync toolchain developers and researchers with specific requirements and experience with the LLVM framework.
We are going to present a more detailed guide for LLVM contributors in the future.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="command-line-interface-cli"><a class="header" href="#command-line-interface-cli">Command Line Interface (CLI)</a></h1>
<p>The CLI of <em>zksolc</em> is designed with resemblance to the CLI of <em>solc</em>. There are several main input/output (I/O) modes in the <em>zksolc</em> interface:</p>
<ul>
<li><a href="02-command-line-interface.html#basic-cli">Basic CLI</a></li>
<li><a href="./03-standard-json.html">Standard JSON</a></li>
<li><a href="./04-combined-json.html">Combined JSON</a></li>
</ul>
<p>The basic CLI and combined JSON modes are more light-weight and suitable for calling from the shell. The standard JSON mode is similar to client-server interaction, thus more suitable for using from other applications, such as <a href="https://github.com/matter-labs/foundry-zksync">Foundry</a>.</p>
<blockquote>
<p>All toolkits using <em>zksolc</em> must be operating in standard JSON mode and follow <a href="./03-standard-json.html">its specification</a>.
It will make the toolkits more robust and future-proof, as the standard JSON mode is the most versatile and used for the majority of popular projects.</p>
</blockquote>
<p>This page focuses on the basic CLI mode. For more information on the other modes, see the corresponding <a href="./04-combined-json.html">combined JSON</a> and <a href="./03-standard-json.html">standard JSON</a> pages.</p>
<h2 id="basic-cli"><a class="header" href="#basic-cli">Basic CLI</a></h2>
<p>Basic CLI mode is the simplest way to compile a file with the source code.</p>
<p>To compile a basic Solidity contract, make sure that <a href="02-command-line-interface.html#--solc">the <em>solc</em> compiler</a> is present in your environment and run the example from <a href="02-command-line-interface.html#--bin">the <em>--bin</em> section</a>.</p>
<p>The rest of this section describes the available CLI options and their usage. You may also check out <code>zksolc --help</code> for a quick reference.</p>
<h3 id="--solc"><a class="header" href="#--solc"><code>--solc</code></a></h3>
<p>Specifies the path to the <em>solc</em> compiler. Useful when the <em>solc</em> compiler is not available in the system path.</p>
<p>Usage:</p>
<pre><code class="language-bash">zksolc Simple.sol --bin --solc '/path/to/solc'
</code></pre>
<blockquote>
<p>Examples in the subsequent sections assume that <em>solc</em> <a href="./01-installation.html#installing-solc">is installed and available</a> in the system path.
If you prefer specifying the full path to <em>solc</em>, use the <code>--solc</code> option with the examples below.</p>
</blockquote>
<h3 id="--bin"><a class="header" href="#--bin"><code>--bin</code></a></h3>
<p>Enables the output of compiled bytecode. The following command compiles a Solidity file and prints the bytecode:</p>
<pre><code class="language-bash">zksolc './Simple.sol' --bin
</code></pre>
<p>Output:</p>
<pre><code class="language-text">======= Simple.sol:Simple =======
Binary:
0000008003000039000000400030043f0000000100200190000000130000c13d...
</code></pre>
<p>It is possible to dry-run the compilation without writing any output. To do this, simply omit <code>--bin</code> and other output options:</p>
<pre><code class="language-bash">zksolc './Simple.sol'
</code></pre>
<p>Output:</p>
<pre><code class="language-text">Compiler run successful. No output requested. Use flags --metadata, --asm, --bin.
</code></pre>
<h3 id="input-files"><a class="header" href="#input-files">Input Files</a></h3>
<p><em>zksolc</em> supports multiple input files. The following command compiles two Solidity files and prints the bytecode:</p>
<pre><code class="language-bash">zksolc './Simple.sol' './Complex.sol' --bin
</code></pre>
<p><a href="https://docs.soliditylang.org/en/latest/path-resolution.html#import-remapping">Solidity import remappings</a> are passed in the way as input files, but they are distinguished by a <code>=</code> symbol between source and destination. The following command compiles a Solidity file with a remapping and prints the bytecode:</p>
<pre><code class="language-bash">zksolc './Simple.sol' 'github.com/ethereum/dapp-bin/=/usr/local/lib/dapp-bin/' --bin
</code></pre>
<p><em>zksolc</em> does not handle remappings itself, but only passes them through to <em>solc</em>.
Visit <a href="https://docs.soliditylang.org/en/latest/using-the-compiler.html#base-path-and-import-remapping">the <em>solc</em> documentation</a> to learn more about the processing of remappings.</p>
<h3 id="--base-path---include-path---allow-paths"><a class="header" href="#--base-path---include-path---allow-paths"><code>--base-path</code>, <code>--include-path</code>, <code>--allow-paths</code></a></h3>
<p>These options are used to specify Solidity import resolution settings. They are not used by <em>zksolc</em> and only passed through to <em>solc</em> like import remappings.</p>
<p>Visit <a href="https://docs.soliditylang.org/en/latest/path-resolution.html">the <em>solc</em> documentation</a> to learn more about the processing of these options.</p>
<h3 id="--asm"><a class="header" href="#--asm"><code>--asm</code></a></h3>
<p>Enables the output of contract assembly. The assembly format depends on the <a href="02-command-line-interface.html#--target"><em>--target</em></a> architecture the contract is compiled for.</p>
<p>For the EraVM assembly specification, visit the <a href="https://docs.zksync.io/zk-stack/components/compiler/specification/binary-layout">EraVM documentation</a>.</p>
<p>EVM assembly is not supported yet.</p>
<p>Usage:</p>
<pre><code class="language-bash">zksolc Simple.sol --asm
</code></pre>
<p>Output:</p>
<pre><code class="language-text">======= Simple.sol:Simple =======
EraVM assembly:
        .text
        .file   "Simple.sol:Simple"
        .globl  __entry
__entry:
.func_begin0:
        add     128, r0, r3
        stm.h   64, r3
...
</code></pre>
<p>The <code>--asm</code> option can be combined with other output options, such as <code>--bin</code>:</p>
<pre><code class="language-bash">zksolc Simple.sol --asm --bin
</code></pre>
<h3 id="--metadata"><a class="header" href="#--metadata"><code>--metadata</code></a></h3>
<p>Enables the output of contract metadata. The metadata is a JSON object that contains information about the contract, such as its name, source code hash, the list of dependencies, compiler versions, and so on.</p>
<p>The <em>zksolc</em> metadata format is compatible with the <a href="https://soliditylang.org/docs/develop/metadata.html">Solidity metadata format</a>. This means that the metadata output can be used with other tools that support Solidity metadata. Essentially, <em>solc</em> metadata is a part of <em>zksolc</em> metadata, and it is included as <code>source_metadata</code> without any modifications.</p>
<p>Usage:</p>
<pre><code class="language-bash">zksolc Simple.sol --metadata
</code></pre>
<p>Output:</p>
<pre><code class="language-text">======= Simple.sol:Simple =======
Metadata:
{"llvm_options":[],"optimizer_settings":{"is_debug_logging_enabled":false,"is_fallback_to_size_enabled":false,"is_verify_each_enabled":false,"level_back_end":"Aggressive","level_middle_end":"Aggressive","level_middle_end_size":"Zero"},"solc_version":"&lt;masked&gt;","solc_zkvm_edition":null,"source_metadata":{...},"zk_version":"&lt;masked&gt;"}
</code></pre>
<h2 id="other-io-modes"><a class="header" href="#other-io-modes">Other I/O Modes</a></h2>
<h3 id="--standard-json"><a class="header" href="#--standard-json"><code>--standard-json</code></a></h3>
<p>For the standard JSON mode usage, see the <a href="./03-standard-json.html">Standard JSON</a> page.</p>
<h3 id="--combined-json"><a class="header" href="#--combined-json"><code>--combined-json</code></a></h3>
<p>For the combined JSON mode usage, see the <a href="./04-combined-json.html">Combined JSON</a> page.</p>
<h2 id="multi-language-support"><a class="header" href="#multi-language-support">Multi-Language Support</a></h2>
<p><em>zksolc</em> supports input in multiple programming languages:</p>
<ul>
<li><a href="https://soliditylang.org/">Solidity</a></li>
<li><a href="https://docs.soliditylang.org/en/latest/yul.html">Yul</a></li>
<li><a href="https://llvm.org/docs/LangRef.html">LLVM IR</a></li>
<li><a href="https://docs.zksync.io/zk-stack/components/compiler/specification/binary-layout">EraVM assembly</a></li>
</ul>
<p>The following sections outline how to use <em>zksolc</em> with these languages.</p>
<h3 id="--yul"><a class="header" href="#--yul"><code>--yul</code></a></h3>
<p>Enables the Yul mode. In this mode, input is expected to be in the Yul language. The output works the same way as with Solidity input.</p>
<p>Usage:</p>
<pre><code class="language-bash">zksolc --yul Simple.yul --bin
</code></pre>
<p>Output:</p>
<pre><code class="language-text">======= Simple.yul =======
Binary:
0000000100200190000000060000c13d0000002a01000039000000000010043f...
</code></pre>
<p><em>zksolc</em> is able to compile Yul without <em>solc</em>. However, using <em>solc</em> is still recommended as it provides additional validation, diagnostics and better error messages:</p>
<pre><code class="language-bash">zksolc --yul Simple.yul --bin --solc '/path/to/solc'
</code></pre>
<p><em>zksolc</em> features its own dialect of Yul with extensions for EraVM. If such extensions (TODO) are used, it is not possible to use <em>solc</em> for validation.</p>
<h3 id="--llvm-ir"><a class="header" href="#--llvm-ir"><code>--llvm-ir</code></a></h3>
<p>Enables the LLVM IR mode. In this mode, input is expected to be in the LLVM IR language. The output works the same way as with Solidity input.</p>
<p>Unlike <em>solc</em>, <em>zksolc</em> is an LLVM-based compiler toolchain, so it uses LLVM IR as an intermediate representation. It is not recommended to write LLVM IR manually, but it can be useful for debugging and optimization purposes. LLVM IR is more low-level than Yul in the ZKsync compiler toolchain IR hierarchy, so <em>solc</em> is not used for compilation.</p>
<p>Usage:</p>
<pre><code class="language-bash">zksolc --llvm-ir Simple.ll --bin
</code></pre>
<p>Output:</p>
<pre><code class="language-text">======= Simple.ll =======
Binary:
000000000002004b000000070000613d0000002001000039000000000010043f...
</code></pre>
<h3 id="--eravm-assembly"><a class="header" href="#--eravm-assembly"><code>--eravm-assembly</code></a></h3>
<p>Enables the EraVM Assembly mode. In this mode, input is expected to be in the EraVM assembly language. The output works the same way as with Solidity input.</p>
<p>EraVM assembly is a representation the closest to EraVM bytecode. It is not recommended to write EraVM assembly manually, but it can be even more useful for debugging and optimization purposes than LLVM IR.</p>
<p>For the EraVM assembly specification, visit the <a href="https://docs.zksync.io/zk-stack/components/compiler/specification/binary-layout">EraVM documentation</a>.</p>
<p>Usage:</p>
<pre><code class="language-bash">zksolc --eravm-assembly Simple.zasm --bin
</code></pre>
<p>Output:</p>
<pre><code class="language-text">======= Simple.zasm =======
Binary:
000000000120008c000000070000613d00000020010000390000000000100435...
</code></pre>
<h2 id="integrated-tooling"><a class="header" href="#integrated-tooling">Integrated Tooling</a></h2>
<p><em>zksolc</em> includes several tools provided by the LLVM framework out of the box, such as disassembler and linker. The following sections describe the usage of these tools.</p>
<blockquote>
<p>The mode-altering CLI options are mutually exclusive. This means that only one of the options below can be enabled at a time:</p>
<ul>
<li><code>--standard-json</code></li>
<li><code>--combined-json</code></li>
<li><code>--yul</code></li>
<li><code>--llvm-ir</code></li>
<li><code>--eravm-assembly</code></li>
<li><code>--disassemble</code></li>
<li><code>--link</code></li>
</ul>
</blockquote>
<h3 id="--disassemble"><a class="header" href="#--disassemble"><code>--disassemble</code></a></h3>
<p>Enables the disassembler mode.</p>
<p><em>zksolc</em> includes an LLVM-based disassembler that can be used to disassemble compiled bytecode.</p>
<p>The disassembler input can be either a binary file or a file with a hexadecimal string. The disassembler output is a human-readable representation of the bytecode, also known as EraVM assembly.</p>
<p>Usage with a hexadecimal string file:</p>
<pre><code class="language-bash">cat './input.hex'
</code></pre>
<p>Output:</p>
<pre><code class="language-text">0x0000008003000039000000400030043f0000000100200190000000140000c13d00000000020...
</code></pre>
<blockquote>
<p>The <code>0x</code> prefix in the front of the hexadecimal string is optional.</p>
</blockquote>
<pre><code class="language-bash">zksolc --disassemble './input.hex'
</code></pre>
<p>Output:</p>
<pre><code class="language-text">File `input.hex` disassembly:

       0: 00 00 00 80 03 00 00 39       add     128, r0, r3
       8: 00 00 00 40 00 30 04 3f       stm.h   64, r3
      10: 00 00 00 01 00 20 01 90       and!    1, r2, r0
      18: 00 00 00 14 00 00 c1 3d       jump.ne 20
      20: 00 00 00 00 02 01 00 19       add     r1, r0, r2
      28: 00 00 00 0b 00 20 01 98       and!    code[11], r2, r0
      30: 00 00 00 23 00 00 61 3d       jump.eq 35
      38: 00 00 00 00 01 01 04 3b       ldp     r1, r1
</code></pre>
<p>Usage with a binary file:</p>
<pre><code class="language-bash">zksolc --disassemble input.bin
</code></pre>
<h2 id="multi-target-support"><a class="header" href="#multi-target-support">Multi-Target Support</a></h2>
<p><em>zksolc</em> is an LLVM-based compiler toolchain, so it is easily extensible to support multiple target architectures. The following targets are supported:</p>
<ul>
<li><code>eravm</code> — <a href="https://docs.zksync.io/zk-stack/components/zksync-evm">EraVM</a> (default).</li>
<li><code>evm</code> — <a href="https://ethereum.org/en/developers/docs/evm/">EVM</a> (under development and only available for testing).</li>
</ul>
<h3 id="--target"><a class="header" href="#--target"><code>--target</code></a></h3>
<p>Specifies the target architecture for the compiled contract.</p>
<div class="warning">
The <code>--target</code> option is experimental and must be passed as a CLI argument in all modes including combined JSON and standard JSON.
</div>
<p>Usage:</p>
<pre><code class="language-bash">zksolc Simple.sol --bin --target evm
</code></pre>
<p>Output:</p>
<pre><code class="language-text">======= Simple.sol:Simple =======
Binary:
0000008003000039000000400030043f0000000100200190000000130000c13d...
</code></pre>
<h3 id="--link"><a class="header" href="#--link"><code>--link</code></a></h3>
<p>Enables the linker mode.</p>
<p><em>zksolc</em> includes an LLVM-based linker that can be used for post-compile-time linking of libraries.</p>
<p>The linker features its own minimal JSON output format:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Field</th><th style="text-align: center">Description</th></tr></thead><tbody>
<tr><td style="text-align: center"><strong>linked</strong></td><td style="text-align: center">Bytecode files where all library references have been successfully resolved. Values are hashes of the bytecode used to identify EraVM dependencies during deployment</td></tr>
<tr><td style="text-align: center"><strong>unlinked</strong></td><td style="text-align: center">If empty, the bytecode in the file <code>./output/Greeter.sol/Greeter.zbin</code> is ready for deployment. The bytecode file is modified in-place, so the original file with unlinked bytecode is overwritten. If not empty, some symbols are left unresolved, so the linker must be called again.</td></tr>
<tr><td style="text-align: center"><strong>ignored</strong></td><td style="text-align: center">Bytecode files already linked before, so they were not processed by the linker in the current call.</td></tr>
</tbody></table>
</div>
<p>Linking is done in several steps:</p>
<ol>
<li>A contract with a library dependency is compiled to bytecode:</li>
</ol>
<pre><code class="language-solidity">// SPDX-License-Identifier: Unlicensed

pragma solidity ^0.8.0;

library GreeterHelper {
    function addPrefix(Greeter greeter, string memory great) public view returns (string memory) {
        return string.concat(greeter._prefix(), great);
    }
}

contract Greeter {
    string public greeting;
    string public _prefix;

    constructor(string memory _greeting) {
        greeting = _greeting;
        _prefix = "The greating is:";
    }

    function greet() public view returns (string memory) {
        return GreeterHelper.addPrefix(this, greeting);
    }
}
</code></pre>
<pre><code class="language-bash">zksolc './Greeter.sol' --output-dir './output' --bin
</code></pre>
<p>For unlinked bytecode, the ZKsync compiler toolchain uses <a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">an ELF wrapper</a> which is the standard of the LLVM framework. ELF-wrapped bytecode is not a valid bytecode that can be deployed to the blockchain. Before deployment, all library references must be resolved. Upon the resolution of the library references, the ELF wrapper is stripped and only the raw bytecode ready for deployment remains. It also means that unlinked and linked bytecodes are not equal in size.</p>
<ol start="2">
<li>Check for unlinked library references.</li>
</ol>
<p>It can be done with the following command, where the <code>--library</code> argument is intentionally omitted:</p>
<pre><code class="language-bash">zksolc --link './output/Greeter.sol/Greeter.zbin' | jq .
</code></pre>
<p>Output:</p>
<pre><code class="language-json">{
  "ignored": {},
  "linked": {},
  "unlinked": {
    "./output/Greeter.sol/Greeter.zbin": [
      "Greeter.sol:GreeterHelper"
    ]
  }
}
</code></pre>
<ol start="3">
<li>Provide library addresses to the linker.</li>
</ol>
<p>The library addresses must be provided in the <code>--libraries</code> argument:</p>
<pre><code class="language-bash">zksolc --link './output/Greeter.sol/Greeter.zbin' --libraries 'Greeter.sol:GreaterHelper=0x1234567812345678123456781234567812345678' | jq .
</code></pre>
<p>Output:</p>
<pre><code class="language-json">{
  "ignored": {},
  "linked": {
    "./output/Greeter.sol/Greeter.zbin": "010000bd2bcef5602ae1ebc0b812cc65d88655a8d972ac10227f142e1838093c"
  },
  "unlinked": {}
}
</code></pre>
<p>If you run the last command above once again, nothing will happen, and the previously linked file will show up as <code>ignored</code>:</p>
<pre><code class="language-json">{
  "ignored": {
    "./output/Greeter.sol/Greeter.zbin": "010000bd2bcef5602ae1ebc0b812cc65d88655a8d972ac10227f142e1838093c"
  },
  "linked": {},
  "unlinked": {}
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="standard-json"><a class="header" href="#standard-json">Standard JSON</a></h1>
<p>Standard JSON is a protocol for interaction with the <em>zksolc</em> and <em>solc</em> compilers. This protocol must be implemented by toolkits such as Hardhat and Foundry.</p>
<p>The protocol uses two data formats for communication: <a href="03-standard-json.html#input-json">input JSON</a> and <a href="03-standard-json.html#output-json">output JSON</a>.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>Input JSON can be provided as the value of the <code>--standard-json</code> option:</p>
<pre><code class="language-shell">zksolc --standard-json input.json
</code></pre>
<p>Alternatively, the input JSON can be fed to <em>zksolc</em> via <em>stdin</em>:</p>
<pre><code class="language-shell">cat input.json | zksolc --standard-json
</code></pre>
<p>After receiving output JSON, the calling program can process it according to its needs. For projects with deployable libraries, <a href="./02-command-line-interface.html#--link">calling the linker</a> is usually required before compiled contracts are ready for deployment.</p>
<blockquote>
<p>For the sake of interface unification, <em>zksolc</em> will always return with exit code 0 and have its standard JSON output printed to <em>stdout</em>.
It differs from <em>solc</em> that may return with exit code 1 and a free-formed error in some cases, such as when the standard JSON input file is missing, even though <a href="https://docs.soliditylang.org/en/latest/using-the-compiler.html#compiler-input-and-output-json-description">the <em>solc</em> documentation claims otherwise</a>.</p>
</blockquote>
<p>The formats below are modifications of the original standard JSON <a href="https://docs.soliditylang.org/en/latest/using-the-compiler.html#input-description">input</a> and <a href="https://docs.soliditylang.org/en/latest/using-the-compiler.html#output-description">output</a> formats implemented by <em>solc</em>. It means that there are:</p>
<ul>
<li><em>zksolc</em>-specific options that are not present in the original format: they are marked as <code>zksolc</code> in the specifications below.</li>
<li><em>solc</em>-specific options that are not supported by <em>zksolc</em>: they are not mentioned in the specifications below.</li>
</ul>
<h2 id="input-json"><a class="header" href="#input-json">Input JSON</a></h2>
<p>The input JSON provides the compiler with the source code and settings for the compilation. The example below serves as the specification of the input JSON format.</p>
<p>Internally, <em>zksolc</em> extracts all <em>zksolc</em>-specific options and converts the input JSON to the subset expected by <em>solc</em> before calling it.</p>
<pre><code class="language-javascript">{
  // Required: Source code language.
  // Currently supported: "Solidity", "Yul", "LLVM IR", "EraVM Assembly".
  "language": "Solidity",
  // Required: Source code files to compile.
  // The keys here are the "global" names of the source files. Imports can be using other file paths via remappings.
  "sources": {
    // In source file entry, either but not both "urls" and "content" must be specified.
    "myFile.sol": {
      // Required (unless "content" is used): URL(s) to the source file.
      "urls": [
        // In Solidity mode, directories must be added to the command-line via "--allow-paths &lt;path&gt;" for imports to work.
        // It is possible to specify multiple URLs for a single source file. In this case the first successfully resolved URL will be used.
        "/tmp/path/to/file.sol"
      ],
      // Required (unless "urls" is used): Literal contents of the source file.
      "content": "contract settable is owned { uint256 private x = 0; function set(uint256 _x) public { if (msg.sender == owner) x = _x; } }"
    }
  },

  // Required: Compilation settings.
  "settings": {
    // Optional: Optimizer settings.
    "optimizer": {
      // Optional, zksolc: Set the zksolc LLVM optimizer level.
      // Available options:
      // -0: do not optimize
      // -1: basic optimizations for gas usage
      // -2: advanced optimizations for gas usage
      // -3: all optimizations for gas usage
      // -s: basic optimizations for deployment cost
      // -z: all optimizations for deployment cost
      // Default: 3.
      "mode": "3",
      // Optional, zksolc: Re-run the compilation with "mode": "z" if the compilation with "mode": "3" fails due to EraVM bytecode size limit.
      // Used on a per-contract basis and applied automatically, so some contracts will end up compiled with "mode": "3", and others with "mode": "z".
      // Default: false.
      "fallbackToOptimizingForSize": false
    },

    // Optional: Sorted list of remappings.
    // Important: Only used with Solidity input.
    "remappings": [ ":g=/dir" ],
    // Optional: Addresses of the libraries.
    // If not all library addresses are provided here, it will result in unlinked bytecode files that will require post-compile-time linking before deployment.
    // Important: Only used with Solidity, Yul, and LLVM IR input.
    "libraries": {
      // The top level key is the name of the source file where the library is used.
      // If remappings are used, this source file should match the global path after remappings were applied.
      "myFile.sol": {
        // Source code library name and address where it is deployed.
        "MyLib": "0x123123..."
      }
    },

    // Optional: Version of the EVM solc will produce IR for.
    // Affects type checking and code generation.
    // Can be "homestead", "tangerineWhistle", "spuriousDragon", "byzantium", "constantinople", "petersburg", "istanbul", "berlin", "london", "paris", "shanghai", "cancun" or "prague" (experimental).
    // Only used with Solidity, and only affects Yul and EVM assembly codegen. For instance, with version "cancun", solc will produce `MCOPY` instructions, whereas with older EVM versions it will not.
    // Default: chosen by solc, is version-dependent.
    "evmVersion": "cancun",
    // Optional: Select the desired output.
    // Important: zksolc does not support per-file and per-contract selection.
    //
    // Available file-level options, must be listed under "*"."":
    //   ast                       AST of all source files
    //
    // Available contract-level options, must be listed under "*"."*":
    //   abi                       Solidity ABI
    //   evm.methodIdentifiers     Solidity function hashes
    //   storageLayout             Slots, offsets and types of the contract's state variables in storage
    //   transientStorageLayout    Slots, offsets and types of the contract's state variables in transient storage
    //   devdoc                    Developer documentation (natspec)
    //   userdoc                   User documentation (natspec)
    //   metadata                  Metadata
    //   evm.legacyAssembly        EVM assembly produced by solc
    //   irOptimized               Yul produced by solc
    //   eravm.assembly            EraVM assembly produced by zksolc
    //
    // Default: no flags are selected, so only bytecode is emitted.
    "outputSelection": {
      "*": {
        "": [
          "ast" // Enable the AST output for the project.
        ],
        "*": [
          "metadata", // Enable the metadata output for the project.
          "irOptimized", // Enable the Yul output for the project.
          "eravm.assembly" // Enable the EraVM assembly output for the project.
        ]
      }
    },
    // Optional: Metadata settings.
    "metadata": {
      // Optional: Use the given hash method for the metadata hash that is appended to the bytecode.
      // Available options: "none", "keccak256", "ipfs".
      // The metadata hash can be removed from the bytecode via option "none".
      // Default: "keccak256".
      "hashType": "ipfs",
      // Optional: Use only literal content and not URLs.
      // Passed through to solc and does not affect the zksolc-specific metadata.
      // Default: false.
      "useLiteralContent": true
    },

    // Optional: Solidity codegen.
    // Can be "evmla" or "yul".
    // In contract to solc, zksolc uses "Yul" codegen by default for solc v0.8.0 and newer. It will be fixed soon, so solc and zksolc defaults will be the same.
    // Default: "evmla" for solc &lt;0.8.0, "yul" for solc &gt;=0.8.0.
    "codegen": "Yul",
    // Optional, Deprecated, zksolc: Use "codegen" instead.
    // Default: false.
    "forceEVMLA": true,
    // Optional, zksolc: Enables the EraVM extensions in Solidity and Yul modes.
    // The extensions include EraVM-specific opcodes and features, such as call forwarding and usage of additional memory spaces.
    // Default: false.
    "enableEraVMExtensions": true,

    // Optional, zksolc: extra LLVM settings.
    "LLVMOptions": [
      "-eravm-jump-table-density-threshold", "10",
      "-tail-dup-size", "6",
      "-eravm-enable-split-loop-phi-live-ranges",
      "-tail-merge-only-bbs-without-succ",
      "-join-globalcopies",
      "-disable-early-taildup"
    ],
    // Optional, zksolc: suppressed errors.
    // Available options: "sendtransfer".
    "suppressedErrors": [
      "sendtransfer"
    ],
    // Optional, zksolc: suppressed warnings.
    // Available options: "txorigin".
    "suppressedWarnings": [
      "txorigin"
    ]
  }
}
</code></pre>
<h2 id="output-json"><a class="header" href="#output-json">Output JSON</a></h2>
<p>The output JSON contains all artifacts produced by both <em>zksolc</em> and <em>solc</em> compilers. The example below serves as the specification of the input JSON format.</p>
<p>If <em>solc</em> is provided to <em>zksolc</em>, the output JSON is initially generated by <em>solc</em>, and ZKsync-specific data is appended by <em>zksolc</em> afterwards. If <em>solc</em> is not provided, the output JSON is generated by <em>zksolc</em> alone.</p>
<pre><code class="language-javascript">{
  // Required: File-level outputs.
  "sources": {
    "sourceFile.sol": {
      // Required: Identifier of the source.
      "id": 1,
      // Optional: The AST object.
      // Corresponds to "ast" in the outputSelection settings.
      "ast": {/* ... */}
    }
  },

  // Required: Contract-level outputs.
  "contracts": {
    // The source name.
    "sourceFile.sol": {
      // The contract name.
      // If the language only supports one contract per file, this field equals to the source name.
      "ContractName": {
        // Optional: The Ethereum Contract ABI (object).
        // See https://docs.soliditylang.org/en/develop/abi-spec.html.
        // Corresponds to "abi" in the outputSelection settings.
        // Provided by solc and passed through by zksolc.
        "abi": [/* ... */],
        // Optional: Storage layout (object).
        // Corresponds to "storageLayout" in the outputSelection settings.
        // Provided by solc and passed through by zksolc.
        "storageLayout": {/* ... */},
        // Optional: Transient storage layout (object).
        // Corresponds to "transientStorageLayout" in the outputSelection settings.
        // Provided by solc and passed through by zksolc.
        "transientStorageLayout": {/* ... */},
        // Optional: Developer documentation (natspec object).
        // Corresponds to "devdoc" in the outputSelection settings.
        // Provided by solc and passed through by zksolc.
        "devdoc": {/* ... */},
        // Optional: User documentation (natspec object).
        // Corresponds to "userdoc" in the outputSelection settings.
        // Provided by solc and passed through by zksolc.
        "userdoc": {/* ... */},
        // Optional: Contract metadata (object).
        // Corresponds to "metadata" in the outputSelection settings.
        // Provided by solc and wrapped with additional data by zksolc.
        "metadata": {/* ... */},
        // Optional: Yul produced by solc (string).
        // Corresponds to "irOptimized" in the outputSelection settings.
        // Provided by solc and passed through by zksolc.
        "irOptimized": "/* ... */",
        // Required: EraVM target outputs.
        "eravm": {
          // Required: EraVM bytecode (string).
          "bytecode": "0000008003000039000000400030043f0000000100200190000000130000c13d...",
          // Optional: EraVM assembly produced by zksolc (string).
          // Corresponds to "eravm.assembly" in the outputSelection settings.
          "assembly": "/* ... */"
        },
        // Required: EVM target outputs.
        // Warning: EraVM artifacts "bytecode" and "assembly" are still returned here within the "evm" object for backward compatibility, but all new applications must be reading from the "eravm" object.
        "evm": {
          // Required, Deprecated(EraVM): EVM bytecode.
          "bytecode": {
            // Required: Bytecode (string).
            "object": "0000008003000039000000400030043f0000000100200190000000130000c13d..."
          },
          // Optional: List of function hashes (object).
          // Corresponds to "evm.methodIdentifiers" in the outputSelection settings.
          // Provided by solc and passed through by zksolc.
          "methodIdentifiers": {
            // Mapping between the function signature and its hash.
            "delegate(address)": "5c19a95c"
          },
          // Optional: EVM assembly produced by solc (object).
          // Corresponds to "evm.legacyAssembly" in the outputSelection settings.
          // Provided by solc and passed through by zksolc.
          "legacyAssembly": {/* ... */},

          // Optional, Deprecated: EraVM assembly produced by zksolc (string).
          // Corresponds to "eravm.assembly" in the outputSelection settings.
          "assembly": "/* ... */"
        },

        // Required, zksolc: EraVM bytecode hash.
        // Used to identify bytecode on ZKsync chains.
        "hash": "5ab89dcf...",
        // Required, zksolc: Mapping between bytecode hashes and full contract identifiers (e.g. "default.sol:Test").
        "factoryDependencies": {/* ... */}
      }
    }
  },

  // Optional: Unset if no messages were emitted.
  "errors": [
    {
      // Optional: Location within the source file.
      // Unset if the error is unrelated to input sources.
      "sourceLocation": {
        /// Required: The source path.
        "file": "sourceFile.sol",
        /// Required: The source location start. Equals -1 if unknown.
        "start": 0,
        /// Required: The source location end. Equals -1 if unknown.
        "end": 100
      },
      // Required: Message type.
      // zksolc only produces "Error" and "Warning" types.
      // *solc* are listed at https://docs.soliditylang.org/en/latest/using-the-compiler.html#error-types.
      "type": "Error",
      // Required: Component the error originates from.
      // zksolc only produces "general".
      // *solc* may produce other values as well.
      "component": "general",
      // Required: Message severity.
      // zksolc only produces "Error" and "Warning" types.
      // *solc* "error", "warning" or "info". May be extended in the future.
      "severity": "error",
      // Optional: Unique code for the cause of the error.
      // Only *solc* produces error codes for now.
      // zksolc error classification is coming soon.
      "errorCode": "3141",
      // Required: Message.
      "message": "Invalid keyword",
      // Required: Message formatted using the source location.
      "formattedMessage": "sourceFile.sol:100: Invalid keyword"
    }
  ],

  // Required: Short semver-compatible solc compiler version.
  "version": "0.8.28",
  // Required: Full solc compiler version.
  "long_version": "0.8.28+commit.7893614a.Darwin.appleclang",
  // Required: Short semver-compatible zksolc compiler version.
  "zk_version": "1.5.6",
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="combined-json"><a class="header" href="#combined-json">Combined JSON</a></h1>
<p>Combined JSON is an I/O mode designed to provide a middle-ground experience between basic CLI and standard JSON. In this mode, input data is provided by the user via CLI, and JSON output can be easily read by both humans and programs calling <em>zksolc</em> as a child process.</p>
<h2 id="usage-1"><a class="header" href="#usage-1">Usage</a></h2>
<p>To use combined JSON, pass the <code>--combined-json</code> flag to <em>zksolc</em> with the desired comma-separated output selectors:</p>
<pre><code class="language-shell">zksolc MyContract.sol --combined-json ast,abi,metadata
</code></pre>
<p>The following selectors are supported:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Selector</th><th style="text-align: center">Description</th><th style="text-align: center">Type</th></tr></thead><tbody>
<tr><td style="text-align: center"><strong>ast</strong></td><td style="text-align: center">AST of the source file</td><td style="text-align: center">JSON</td></tr>
<tr><td style="text-align: center"><strong>abi</strong></td><td style="text-align: center">Solidity ABI</td><td style="text-align: center">JSON</td></tr>
<tr><td style="text-align: center"><strong>hashes</strong></td><td style="text-align: center">Solidity function hashes</td><td style="text-align: center">JSON</td></tr>
<tr><td style="text-align: center"><strong>storage-layout</strong></td><td style="text-align: center">Solidity storage layout</td><td style="text-align: center">JSON</td></tr>
<tr><td style="text-align: center"><strong>metadata</strong></td><td style="text-align: center">Metadata</td><td style="text-align: center">Stringified JSON</td></tr>
<tr><td style="text-align: center"><strong>devdoc</strong></td><td style="text-align: center">Developer documentation</td><td style="text-align: center">JSON (NatSpec)</td></tr>
<tr><td style="text-align: center"><strong>userdoc</strong></td><td style="text-align: center">User documentation</td><td style="text-align: center">JSON (NatSpec)</td></tr>
</tbody></table>
</div><div class="warning">
It is only possible to use Combined JSON with Solidity input, so the path to <b>solc</b> must be always provided to *zksolc*.
Support for other languages is planned for future releases.
</div>
<h2 id="output-format"><a class="header" href="#output-format">Output Format</a></h2>
<p>The format below is a modification of the original combined JSON <a href="https://docs.soliditylang.org/en/latest/using-the-compiler.html#output-description">output</a> format implemented by <em>solc</em>. It means that there are:</p>
<ul>
<li><em>zksolc</em>-specific options that are not present in the original format: they are marked as <em>zksolc</em> in the specification below.</li>
<li><em>solc</em>-specific options that are not supported by <em>zksolc</em>: they are not mentioned in the specification below.</li>
</ul>
<pre><code class="language-javascript">{
  // Required: Contract outputs.
  "contracts": {
    "MyContract.sol:Test": {
      // Optional: Emitted if "hashes" selector is provided.
      "hashes": {/* ... */},
      // Optional: Emitted if "abi" selector is provided.
      "abi": [/* ... */],
      // Optional: Emitted if "metadata" selector is provided.
      "metadata": "/* ... */",
      // Optional: Emitted if "devdoc" selector is provided.
      "devdoc": {/* ... */},
      // Optional: Emitted if "userdoc" selector is provided.
      "userdoc": {/* ... */},
      // Optional: Emitted if "storage-layout" selector is provided.
      "storage-layout": {/* ... */},
      // Required: Bytecode is always emitted.
      "bin": "0000008003000039000000400030043f0000000100200190000000130000c13d...",
      // Required: Bytecode is always emitted.
      "bin-runtime": "0000008003000039000000400030043f0000000100200190000000130000c13d...",
      // Required, zksolc: Mapping between bytecode hashes and full contract identifiers (e.g. "MyContract.sol:Test").
      "factory-deps": {/* ... */}
    }
  },
  // Optional: List of input files.
  // Only emitted if "ast" selector is provided.
  "sourceList": [
    "MyContract.sol"
  ],
  // Optional: List of input sources.
  // Only emitted if "ast" selector is provided.
  "sources": {
    "MyContract.sol": {
      // Required: Contract AST.
      "AST": {/* ... */}
      // Required: Contract index in "sourceList".
      "id": 0
    }
  },
  // Required: Version of solc.
  "version": "0.8.28+commit.acc7d8f9.Darwin.appleclang",
  // Required, zksolc: Version of zksolc.
  "zk_version": "1.5.6"
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="js/version-box.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
