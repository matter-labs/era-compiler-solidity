<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Installation - ZKsync Solidity Compiler Toolchain Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="css/version-box.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="01-installation.html" class="active"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="02-command-line-interface.html"><strong aria-hidden="true">2.</strong> Command Line Interface</a></li><li class="chapter-item expanded "><a href="03-standard-json.html"><strong aria-hidden="true">3.</strong> Standard JSON</a></li><li class="chapter-item expanded "><a href="04-combined-json.html"><strong aria-hidden="true">4.</strong> Combined JSON</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ZKsync Solidity Compiler Toolchain Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="installing-the-zksync-solidity-compiler-toolchain"><a class="header" href="#installing-the-zksync-solidity-compiler-toolchain">Installing the ZKsync Solidity Compiler Toolchain</a></h1>
<p>To compile contracts for ZKsync, you need the ZKsync Solidity compiler toolchain.
It consists of two components:</p>
<ol>
<li>The main component: <a href="https://github.com/matter-labs/era-compiler-solidity/releases"><em>zksolc</em></a>.</li>
<li>The additional component: <a href="https://docs.soliditylang.org/en/latest"><em>solc</em></a>, which produces Solidity artifacts used by <em>zksolc</em>.</li>
</ol>
<blockquote>
<p>We are using our <a href="https://github.com/matter-labs/era-solidity">fork</a> of the upstream <em>solc</em> compiler.
The fork is necessary to support several ZKsync-specific features and workarounds.</p>
</blockquote>
<h2 id="system-requirements"><a class="header" href="#system-requirements">System Requirements</a></h2>
<p>It is recommended to have at least 4 GB of RAM to compile large projects. The compilation process is parallelized by default, so the number of threads used is
equal to the number of CPU cores.</p>
<blockquote>
<p>Large projects can consume a lot of RAM during compilation on machines with a high number of cores.
If you encounter memory issues, consider reducing the number of threads using the <code>--threads</code> option.</p>
</blockquote>
<p>The table below outlines the supported platforms and architectures:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">CPU/OS</th><th style="text-align: center">MacOS</th><th style="text-align: center">Linux</th><th style="text-align: center">Windows</th></tr></thead><tbody>
<tr><td style="text-align: center">x86_64</td><td style="text-align: center">✅</td><td style="text-align: center">✅</td><td style="text-align: center">✅</td></tr>
<tr><td style="text-align: center">arm64</td><td style="text-align: center">✅</td><td style="text-align: center">✅</td><td style="text-align: center">❌</td></tr>
</tbody></table>
</div>
<blockquote>
<p>Please avoid using outdated distributions of operating systems, as they may lack the necessary dependencies or include outdated versions of them.
<em>zksolc</em> is only tested on recent versions of popular distributions, such as MacOS 11.0 and Windows 10.</p>
</blockquote>
<div class="warning">
<a href="https://musl.libc.org">musl</a>-based builds are deprecated, but they are still supported to preserve tooling compatibility.<br>
Starting from <b>zksolc</b> v1.5.3, we are shipping builds statically linked with <a href="https://www.gnu.org/software/libc/">the GNU C library</a>.
</div>
<h2 id="versioning"><a class="header" href="#versioning">Versioning</a></h2>
<p>The <em>zksolc</em> versioning scheme does not yet follow the <a href="https://semver.org">Semantic Versioning</a> specification. Instead, its major and minor versions match those of the EraVM protocol for which <em>zksolc</em> produces bytecode. The patch version is incremented with each release, regardless of whether breaking changes are introduced. Therefore, please consult the changelog before updating the compiler.</p>
<blockquote>
<p>We recommend always using the latest version of <em>zksolc</em> and <em>solc</em> to benefit from the latest features and bug fixes.</p>
</blockquote>
<h2 id="installing-zksolc"><a class="header" href="#installing-zksolc">Installing <em>zksolc</em></a></h2>
<p>You can install the ZKsync Solidity compiler toolchain using the following methods:</p>
<ol>
<li>Use Foundry, Hardhat, or other popular toolkits, so they will manage the compiler installation and their dependencies for you. See <a href="#ethereum-development-toolkits">Ethereum Development Toolkits</a>.</li>
<li>Download pre-built binaries of <a href="https://github.com/matter-labs/era-solidity/releases"><em>solc</em></a> and <a href="https://github.com/matter-labs/era-compiler-solidity/releases"><em>zksolc</em></a>. See <a href="#static-executables">Static Executables</a>.</li>
<li>Build <em>zksolc</em> from sources. See <a href="#building-from-source">Building from Source</a>.</li>
</ol>
<blockquote>
<p>For small projects, learning and research purposes, <em>zksolc</em> and <em>solc</em> executables without a toolkit are sufficient.</p>
</blockquote>
<h2 id="installing-solc"><a class="header" href="#installing-solc">Installing <em>solc</em></a></h2>
<p>Running <em>zksolc</em> requires the <a href="https://github.com/matter-labs/era-solidity/releases">fork of the Solidity compiler <em>solc</em></a>, which is called by <em>zksolc</em> as a child process. To point <em>zksolc</em> to the location of <em>solc</em>, use one of the following methods:</p>
<ol>
<li>
<p>Add the location of <em>solc</em> to the environment variable <code>PATH</code>.</p>
<p>For example, if you have downloaded <em>solc</em> to the directory <code>/home/username/opt</code>,
you can execute the following command, or append it to the configuration file of your shell:</p>
<pre><code class="language-shell">export PATH="/home/username/opt:${PATH}"
</code></pre>
</li>
<li>
<p>Alternatively, when you run <em>zksolc</em>, provide the full path to <em>solc</em> using the <code>--solc</code> option.</p>
<p>For example, if <code>solc</code> is located in your current working directory, you can point to it with this command:</p>
<pre><code class="language-shell">zksolc --solc './solc' --bin 'Greeter.sol'
</code></pre>
</li>
</ol>
<blockquote>
<p>The second option is more convenient if you are using different versions of <em>solc</em> for different projects.
<em>zksolc</em> only supports <em>solc</em> of version 0.4.12 and newer.</p>
</blockquote>
<h2 id="ethereum-development-toolkits"><a class="header" href="#ethereum-development-toolkits">Ethereum Development Toolkits</a></h2>
<p>For large codebases, it is more convenient to use the ZKsync compiler toolchain via toolkits like Foundry and Hardhat.
These tools manage the compiler executables and their dependencies, and provide additional features like incremental compilation and caching.</p>
<p>The ZKsync toolchain is supported by the following toolkits:</p>
<p><em>TODO: Add links to the tutorials</em></p>
<h2 id="static-executables"><a class="header" href="#static-executables">Static Executables</a></h2>
<p>We ship <em>zksolc</em> binaries on the <a href="https://github.com/matter-labs/era-compiler-solidity/releases">releases page of <code>matter-labs/era-compiler-solidity</code> repository</a>.
This repository maintains intuitive and stable naming for the executables and provides a changelog for each release. Tools using <em>zksolc</em> will download the binaries from this repository and cache them locally.</p>
<div class="warning">
The <a href="https://github.com/matter-labs/era-compiler-solidity">matter-labs/era-compiler-solidity</a> repository only contains builds for versions 1.4.0 and newer.<br>
You can download older versions from <a href="https://github.com/matter-labs/zksolc-bin/tree/main">the main branch</a> or <a href="https://github.com/matter-labs/zksolc-bin/releases">the releases page</a> of the deprecated repository for zksolc executables.<br>
If any of your projects are still using the old locations, please change their download URLs to <a href="https://github.com/matter-labs/era-compiler-solidity/releases">the new one</a>.
</div>
<blockquote>
<p>All binaries are statically linked and must work on all recent platforms without issues.
<em>zksolc</em> is fully written in Rust, aiming to minimize incompatibilities with the environment.</p>
</blockquote>
<h2 id="building-from-source"><a class="header" href="#building-from-source">Building from Source</a></h2>
<blockquote>
<p>Please consider using the pre-built executables before building from source.
Building from source is only necessary for development, research, and debugging purposes.
Deployment and production use cases should rely only on <a href="#static-executables">the officially released executables</a>.</p>
</blockquote>
<ol>
<li>
<p>Install the necessary system-wide dependencies.</p>
<ul>
<li>For Linux (Debian):</li>
</ul>
<pre><code class="language-shell">apt install cmake ninja-build curl git libssl-dev pkg-config clang lld
</code></pre>
<ul>
<li>For Linux (Arch):</li>
</ul>
<pre><code class="language-shell">pacman -Syu which cmake ninja curl git pkg-config clang lld
</code></pre>
<ul>
<li>
<p>For MacOS:</p>
<ol>
<li>
<p>Install the <em>Homebrew</em> package manager by following the instructions at <a href="https://brew.sh">brew.sh</a>.</p>
</li>
<li>
<p>Install the necessary system-wide dependencies:</p>
<pre><code class="language-shell">brew install cmake ninja coreutils
</code></pre>
</li>
<li>
<p>Install a recent build of the LLVM/<a href="https://clang.llvm.org">Clang</a> compiler using one of the following tools:</p>
<ul>
<li><a href="https://developer.apple.com/xcode/">Xcode</a></li>
<li><a href="https://developer.apple.com/library/archive/technotes/tn2339/_index.html">Apple’s Command Line Tools</a></li>
<li>Your preferred package manager.</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
<li>
<p>Install Rust.</p>
<p>The easiest way to do it is following the latest <a href="https://www.rust-lang.org/tools/install">official instructions</a>.</p>
</li>
</ol>
<blockquote>
<p>The Rust version used for building is pinned in the <a href="../rust-toolchain.toml">rust-toolchain.toml</a> file at the repository root.
<em>cargo</em> will automatically download the pinned version of <em>rustc</em> when you start building the project.</p>
</blockquote>
<ol start="3">
<li>
<p>Clone and checkout this repository.</p>
<pre><code class="language-shell">git clone https://github.com/matter-labs/era-compiler-solidity
</code></pre>
</li>
<li>
<p>Install the ZKsync LLVM framework builder. This tool clones the <a href="https://github.com/matter-labs/era-compiler-llvm">repository of ZKsync LLVM Framework</a> and runs a sequence of build commands tuned for the needs of ZKsync compiler toolchain.</p>
<pre><code class="language-shell">cargo install compiler-llvm-builder
</code></pre>
<p>To fine-tune your build of ZKsync LLVM framework, refer to the section <a href="#fine-tuning-zksync-llvm-build">Fine tuning ZKsync LLVM build</a></p>
</li>
</ol>
<blockquote>
<p>Always use the latest version of the builder to benefit from the latest features and bug fixes.
To check for new versions and update the builder, simply run <code>cargo install compiler-llvm-builder</code> again, even if you have already installed the builder.
The builder is not the ZKsync LLVM framework itself, but a tool to build it.
By default, it is installed in <code>~/.cargo/bin/</code>, which is usually added to your <code>PATH</code> during the Rust installation process.</p>
</blockquote>
<ol start="5">
<li>
<p>Clone and build the ZKsync LLVM framework using the <code>zksync-llvm</code> tool.</p>
<pre><code class="language-shell"># Navigate to the root of your local copy of this repository.
cd era-compiler-solidity
# Clone the ZKsync LLVM framework. The branch is specified in the file `LLVM.lock`.
zksync-llvm clone
# Build the ZKsync LLVM framework.
zksync-llvm build
</code></pre>
<p>For more information and available build options, run <code>zksync-llvm build --help</code>.</p>
<p>You can also clone and build LLVM framework outside of the repository root.
In this case, do the following:</p>
<ol>
<li>
<p>Provide an <code>LLVM.lock</code> file in the directory where you run <code>zksync-llvm</code>.
See the <a href="../LLVM.lock">default LLVM.lock for an example</a>.</p>
</li>
<li>
<p>Ensure that <code>LLVM.lock</code> selects the correct branch of the <a href="https://github.com/matter-labs/era-compiler-llvm">ZKsync LLVM Framework repository</a>.</p>
</li>
<li>
<p>Before proceeding to the next step, set the environment variable <code>LLVM_SYS_170_PREFIX</code> to the path of the directory with the LLVM build artifacts.
Typically, it ends with <code>target-llvm/build-final</code>, which is the default LLVM target directory of the LLVM builder. For example:</p>
<pre><code class="language-shell">export LLVM_SYS_170_PREFIX=~/repositories/era-compiler-solidity/target-llvm/build-final 
</code></pre>
</li>
</ol>
</li>
<li>
<p>Build the <em>zksolc</em> executable.</p>
<pre><code class="language-shell">cargo build --release
</code></pre>
<p>The <em>zksolc</em> executable will appear at <code>./target/release/zksolc</code>, where you can run it directly or move it to another location.</p>
<p>If <em>cargo</em> cannot find the LLVM build artifacts, return to the previous step and ensure that the <code>LLVM_SYS_170_PREFIX</code> environment variable is set to the absolute path of the directory <code>target-llvm/build-final</code>.</p>
</li>
</ol>
<h2 id="tuning-the-zksync-llvm-build"><a class="header" href="#tuning-the-zksync-llvm-build">Tuning the ZKsync LLVM build</a></h2>
<ul>
<li>
<p>For more information and available build options, run <code>zksync-llvm build --help</code>.</p>
</li>
<li>
<p>Use the <code>--use-ccache</code> option to speed up the build process if you have <a href="https://ccache.dev">ccache</a> installed.</p>
</li>
<li>
<p>To build ZKsync LLVM framework using specific C and C++ compilers, pass additional arguments to <a href="https://cmake.org/">CMake</a> using the <code>--extra-args</code> option:</p>
<pre><code class="language-shell"># Pay special attention to character escaping.

zksync-llvm build \
  --use-ccache \
  --extra-args \
    '\-DCMAKE_C_COMPILER=/opt/homebrew/Cellar/llvm@18/18.1.8/bin/clang' \
    '\-DCMAKE_BUILD_TYPE=Release' \
    '\-DCMAKE_CXX_COMPILER=/opt/homebrew/Cellar/llvm@18/18.1.8/bin/clang++' 
</code></pre>
</li>
</ul>
<h3 id="building-llvm-manually"><a class="header" href="#building-llvm-manually">Building LLVM manually</a></h3>
<ul>
<li>
<p>If you prefer building <a href="https://github.com/matter-labs/era-compiler-llvm">your ZKsync LLVM</a> manually, include the following flags in your CMake command:</p>
<pre><code class="language-shell"># We recommended using the latest version of CMake.

-DLLVM_TARGETS_TO_BUILD='EraVM;EVM'
-DLLVM_ENABLE_PROJECTS='lld'
-DBUILD_SHARED_LIBS='Off'
</code></pre>
</li>
</ul>
<blockquote>
<p>For most users, the <a href="#building-from-source">ZKsync LLVM builder</a> is the recommended way to build the ZKsync LLVM framework.
This section exists for the ZKsync toolchain developers and researchers with specific requirements and experience with the LLVM framework.
We are going to present a more detailed guide for LLVM contributors in the future.</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next prefetch" href="02-command-line-interface.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next prefetch" href="02-command-line-interface.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="js/version-box.js"></script>


    </div>
    </body>
</html>
